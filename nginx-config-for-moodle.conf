server {

    # TODO: Put here your ServerName
    server_name ;

    # Enable X-Sendfile, replace "dataroot" with your moodledata directory
    location /dataroot/ {
     internal;
     alias ; # ensure the path ends with /
    }

  
    root ;
    index index.php index.html index.htm;

    autoindex off;

    # 2) Convert any 403 to 404 (covers directories without index files)
    error_page 403 =404 /__404__;    # internal rewrite, not a redirect

    # Internal dummy 404 location (no file needed)
    location = /__404__ { return 404; }

    location ~ [^/]\.php(/|$) {
        fastcgi_split_path_info     ^(.+\.php)(/.+)$;
        fastcgi_index               index.php;
        fastcgi_pass                unix:/run/php/php8.2-fpm.sock;
        include                     fastcgi_params;
        fastcgi_param               SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param               PATH_INFO       $fastcgi_path_info;
    }

    location ~ /\. {
       return 404;
    }

    location ~* /(composer\.(json|lock)|package(-lock)?\.json|yarn\.lock|webpack\..*|vite\..*|gulpfile\..*|Gruntfile\..*|phpunit\.(xml|xml\.dist)|phpcs\.xml(\.dist)?|\.user\.ini|Dockerfile|docker-compose\.ya?ml|environment\.xml|install\.xml)$ {
        return 404;
    }

   # 1) Broad: block README-like files (README, README.md, readme.txt, etc.)
    location ~* (^|/)(readme(\.[^/]+)?)$ {
        return 404;
    }

    location ~* (readme_moodle\.txt|readme(\.[^/]+)?|changelog(\.[^/]+)?|license(\.[^/]+)?)$ {
        return 404;
    }

    # Block upgrade note files
    location ~* /(UPGRADE|UPGRADING)(\.[A-Za-z0-9._-]+)?$ {
        return 404;
    }

    # Block any /fixtures/ path with 404
    location ~* (^|/)(fixtures)(/|$) {
        return 404;
    }

    location ~* (^|/)behat(/|$) {
        return 404;
    }

   

}
